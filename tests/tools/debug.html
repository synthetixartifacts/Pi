<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi Voice Assistant - Debug Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            background: #0a0a0a;
            color: #00ff00;
            padding: 10px;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 15px;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .panel {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 5px;
            padding: 15px;
            position: relative;
        }
        
        .panel h3 {
            color: #00ff00;
            margin-bottom: 10px;
            font-size: 14px;
            text-transform: uppercase;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .status-card {
            background: #222;
            padding: 10px;
            border-radius: 3px;
            text-align: center;
        }
        
        .status-card.healthy {
            border: 1px solid #00ff00;
        }
        
        .status-card.error {
            border: 1px solid #ff0000;
        }
        
        .status-card.loading {
            border: 1px solid #ffff00;
        }
        
        .audio-controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        
        button {
            background: #333;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
        }
        
        button:hover {
            background: #00ff00;
            color: #000;
        }
        
        button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .log-area {
            background: #000;
            border: 1px solid #333;
            padding: 10px;
            height: 200px;
            overflow-y: auto;
            font-size: 11px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
        }
        
        .data-display {
            background: #111;
            border: 1px solid #222;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .data-display pre {
            color: #0ff;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        canvas {
            width: 100%;
            height: 100px;
            background: #000;
            border: 1px solid #333;
            margin: 10px 0;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #222;
            font-size: 12px;
        }
        
        .metric-value {
            color: #0ff;
            font-weight: bold;
        }
        
        .recording-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #ff0000;
            border-radius: 50%;
            margin-left: 10px;
            animation: pulse 1s infinite;
            display: none;
        }
        
        .recording-indicator.active {
            display: inline-block;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .test-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 10px 0;
        }
        
        input[type="text"], textarea {
            background: #111;
            border: 1px solid #333;
            color: #00ff00;
            padding: 8px;
            width: 100%;
            font-family: inherit;
            font-size: 12px;
        }
        
        .api-endpoint {
            background: #111;
            padding: 5px;
            margin: 5px 0;
            border-left: 3px solid #0ff;
            font-size: 11px;
        }
        
        .timestamp {
            color: #888;
            font-size: 10px;
        }
        
        .error-text {
            color: #ff0000;
        }
        
        .success-text {
            color: #00ff00;
        }
        
        .warning-text {
            color: #ffff00;
        }
        
        .expandable {
            cursor: pointer;
            user-select: none;
        }
        
        .expandable::before {
            content: 'â–¶ ';
        }
        
        .expandable.expanded::before {
            content: 'â–¼ ';
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1 style="text-align: center; margin: 20px 0; color: #00ff00;">ðŸ”§ PI VOICE ASSISTANT - DEBUG DASHBOARD ðŸ”§</h1>
    
    <div class="dashboard">
        <!-- Service Status Panel -->
        <div class="panel">
            <h3>Service Health Monitor</h3>
            <div class="status-grid">
                <div class="status-card loading" id="stt-status">
                    <div>STT</div>
                    <div class="metric-value" id="stt-status-text">Checking...</div>
                </div>
                <div class="status-card loading" id="tts-status">
                    <div>TTS</div>
                    <div class="metric-value" id="tts-status-text">Checking...</div>
                </div>
                <div class="status-card loading" id="n8n-status">
                    <div>n8n</div>
                    <div class="metric-value" id="n8n-status-text">Checking...</div>
                </div>
            </div>
            <div class="api-endpoint">STT: /api/stt/v1/audio/transcriptions</div>
            <div class="api-endpoint">TTS: /api/tts/api/tts</div>
            <div class="api-endpoint">n8n: /api/n8n/webhook/*</div>
        </div>
        
        <!-- Audio Recording Panel -->
        <div class="panel">
            <h3>Audio Recording Debug <span class="recording-indicator" id="recording-indicator"></span></h3>
            <canvas id="waveform"></canvas>
            <div class="metric">
                <span>Sample Rate:</span>
                <span class="metric-value" id="sample-rate">-</span>
            </div>
            <div class="metric">
                <span>Audio Format:</span>
                <span class="metric-value" id="audio-format">-</span>
            </div>
            <div class="metric">
                <span>Recording Duration:</span>
                <span class="metric-value" id="recording-duration">0s</span>
            </div>
            <div class="metric">
                <span>Audio Size:</span>
                <span class="metric-value" id="audio-size">0 KB</span>
            </div>
            <div class="metric">
                <span>Channels:</span>
                <span class="metric-value" id="channels">-</span>
            </div>
            <div class="audio-controls">
                <button id="start-recording">Start Recording</button>
                <button id="stop-recording" disabled>Stop Recording</button>
                <button id="play-recorded" disabled>Play Recorded</button>
                <button id="download-recorded" disabled>Download Audio</button>
            </div>
            <div class="data-display">
                <div class="expandable" onclick="toggleExpand(this)">Raw Audio Data</div>
                <pre id="audio-data" class="hidden">No audio recorded yet</pre>
            </div>
        </div>
        
        <!-- STT Debug Panel -->
        <div class="panel">
            <h3>Speech-to-Text Debug</h3>
            <div class="metric">
                <span>Last Request Time:</span>
                <span class="metric-value" id="stt-request-time">-</span>
            </div>
            <div class="metric">
                <span>Response Time:</span>
                <span class="metric-value" id="stt-response-time">-</span>
            </div>
            <div class="metric">
                <span>Model Used:</span>
                <span class="metric-value" id="stt-model">small.en</span>
            </div>
            <div class="audio-controls">
                <button id="test-stt-current">Test with Current Audio</button>
                <button id="test-stt-file">Test with Sample File</button>
            </div>
            <div class="data-display">
                <div><strong>Last STT Result:</strong></div>
                <pre id="stt-result">No results yet</pre>
            </div>
            <div class="data-display">
                <div class="expandable" onclick="toggleExpand(this)">Raw API Response</div>
                <pre id="stt-raw-response" class="hidden">No response yet</pre>
            </div>
        </div>
        
        <!-- TTS Debug Panel -->
        <div class="panel">
            <h3>Text-to-Speech Debug</h3>
            <div class="metric">
                <span>Voice Model:</span>
                <span class="metric-value" id="tts-voice">en_US-amy-medium</span>
            </div>
            <div class="metric">
                <span>Last Generation Time:</span>
                <span class="metric-value" id="tts-gen-time">-</span>
            </div>
            <textarea id="tts-input" placeholder="Enter text to synthesize..." rows="3">Testing one two three. This is a test of the text to speech system.</textarea>
            <div class="audio-controls">
                <button id="test-tts">Generate Speech</button>
                <button id="play-tts" disabled>Play Generated</button>
                <button id="download-tts" disabled>Download WAV</button>
            </div>
            <div class="data-display">
                <div><strong>TTS Response:</strong></div>
                <pre id="tts-result">No generation yet</pre>
            </div>
        </div>
        
        <!-- Pipeline Test Panel -->
        <div class="panel">
            <h3>Full Pipeline Test</h3>
            <div class="test-section">
                <button id="test-pipeline-simple">Test Simple Pipeline</button>
                <button id="test-pipeline-wake">Test with Wake Word</button>
                <button id="test-continuous">Start Continuous Mode</button>
                <button id="stop-continuous" disabled>Stop Continuous</button>
            </div>
            <div class="metric">
                <span>Total Latency:</span>
                <span class="metric-value" id="total-latency">-</span>
            </div>
            <div class="metric">
                <span>Recording â†’ STT:</span>
                <span class="metric-value" id="record-stt-latency">-</span>
            </div>
            <div class="metric">
                <span>STT â†’ TTS:</span>
                <span class="metric-value" id="stt-tts-latency">-</span>
            </div>
            <div class="metric">
                <span>TTS â†’ Playback:</span>
                <span class="metric-value" id="tts-play-latency">-</span>
            </div>
        </div>
        
        <!-- Main Console Log -->
        <div class="panel" style="grid-column: span 2;">
            <h3>System Console</h3>
            <div class="audio-controls">
                <button onclick="clearConsole()">Clear</button>
                <button onclick="downloadLogs()">Download Logs</button>
                <button onclick="copyDebugInfo()" style="background: #0ff; color: #000;">Copy Debug Info</button>
                <label style="margin-left: 20px;">
                    <input type="checkbox" id="auto-scroll" checked> Auto-scroll
                </label>
            </div>
            <div class="log-area" id="console-log"></div>
        </div>
        
        <!-- Raw Data Inspector -->
        <div class="panel">
            <h3>Data Inspector</h3>
            <div class="data-display">
                <div><strong>MediaRecorder State:</strong></div>
                <pre id="recorder-state">Not initialized</pre>
            </div>
            <div class="data-display">
                <div><strong>Audio Context:</strong></div>
                <pre id="audio-context-info">Not initialized</pre>
            </div>
            <div class="data-display">
                <div><strong>Browser Capabilities:</strong></div>
                <pre id="browser-caps">Checking...</pre>
            </div>
        </div>
        
        <!-- Configuration Panel -->
        <div class="panel">
            <h3>Configuration</h3>
            <div class="metric">
                <span>Recording Duration (ms):</span>
                <input type="number" id="config-duration" value="3000" style="width: 100px;">
            </div>
            <div class="metric">
                <span>STT Model:</span>
                <select id="config-model" style="background: #111; color: #0f0; border: 1px solid #333;">
                    <option value="tiny.en">tiny.en</option>
                    <option value="base.en">base.en</option>
                    <option value="small.en" selected>small.en</option>
                    <option value="medium.en">medium.en</option>
                </select>
            </div>
            <div class="metric">
                <span>Echo Cancellation:</span>
                <input type="checkbox" id="config-echo" checked>
            </div>
            <div class="metric">
                <span>Noise Suppression:</span>
                <input type="checkbox" id="config-noise" checked>
            </div>
            <button onclick="applyConfig()">Apply Configuration</button>
        </div>
    </div>
    
    <script src="./debug.js"></script>
</body>
</html>